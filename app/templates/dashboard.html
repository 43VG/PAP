{% extends "homepage.html" %}  <!-- Herda a estrutura da homepage, incluindo o menu -->

{% block content %}
<div class="container">
    <h1>Bem-vindo ao Dashboard, {{ current_user.nome }}!</h1>

    {% if preview_html %}
        <!-- Mostra a tabela de preview -->
        <h3>Preview dos dados selecionados</h3>
        <div>{{ preview_html|safe }}</div>

    {% elif folhas_por_ficheiro %}
        <hr>
        <!-- Formulário para seleção das folhas desejadas de cada ficheiro -->
        <form action="{{ url_for('rotas.selecionar_folhas') }}" method="post">
            <h3>Selecione as folhas que quer usar:</h3>
            {% for nome, folhas in folhas_por_ficheiro.items() %}
                <strong>{{ nome }}</strong><br>
                {% for folha in folhas %}
                    <input type="checkbox" name="selecionadas_{{ nome }}" value="{{ folha }}" checked>
                    {{ folha }}<br>  <!-- Mostra as folhas de cada ficheiro com checkbox marcado -->
                {% endfor %}
                <br>
            {% endfor %}

            <!-- Campos ocultos com os nomes dos ficheiros, para manter a referência no POST -->
            {% for nome in folhas_por_ficheiro %}
                <input type="hidden" name="ficheiros_nome" value="{{ nome }}">
            {% endfor %}

            <button type="submit">Confirmar folhas</button>
        </form>

    {% else %}
        <!-- Formulário para upload de múltiplos ficheiros Excel -->
        <form action="{{ url_for('rotas.upload_excel') }}" method="post" enctype="multipart/form-data">
            <label for="ficheiros">Seleciona ficheiros Excel:</label><br>
            <input type="file" name="ficheiros" multiple required><br><br>  <!-- Permite enviar vários ficheiros ao mesmo tempo -->
            <button type="submit">Carregar ficheiros</button>
        </form>
    {% endif %}
</div>
{% endblock %}
