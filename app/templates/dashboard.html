{% extends "homepage.html" %}  <!-- Herda a estrutura da homepage, incluindo o menu -->

{% block content %}
<div class="container">
    <h1>Bem-vindo ao Dashboard, {{ current_user.nome }}!</h1>

    {% if preview_html %}
        <!-- Mostra a tabela de preview -->
        <h3>Preview dos dados selecionados</h3>
        <div>{{ preview_html|safe }}</div>

        <!-- Se칞칚o de Gr치ficos -->
        <div class="graph-section mt-4">
            <h3>Gerar Gr치ficos</h3>
            <form action="{{ url_for('rotas.gerar_grafico') }}" method="post">
                <div class="form-group">
                    <label for="coluna_x">Coluna X (Texto):</label>
                    <select class="form-control" name="coluna_x" id="coluna_x" required>
                        {% for coluna in colunas_texto %}
                            <option value="{{ coluna }}">{{ coluna }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="coluna_y">Coluna Y (Num칠rica):</label>
                    <select class="form-control" name="coluna_y" id="coluna_y" required>
                        {% for coluna in colunas_numericas %}
                            <option value="{{ coluna }}">{{ coluna }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label>Tipos de Gr치ficos:</label><br>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="tipos_graficos" value="Barras" id="barras">
                        <label class="form-check-label" for="barras">Barras</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="tipos_graficos" value="Linhas" id="linhas">
                        <label class="form-check-label" for="linhas">Linhas</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="tipos_graficos" value="Pizza" id="pizza">
                        <label class="form-check-label" for="pizza">Pizza</label>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Gerar Gr치ficos</button>
            </form>
        </div>

        {% if graficos %}
            <div class="graphs-container mt-4">
                {% for tipo, grafico in graficos.items() %}
                    <div class="graph-item mb-4">
                        <h4>Gr치fico de {{ tipo }}</h4>
                        {{ grafico|safe }}
                        <div class="mt-2">
                            <a href="{{ url_for('rotas.exportar_grafico', tipo=tipo, formato='png') }}" class="btn btn-sm btn-secondary">游닌 Exportar como PNG</a>
                            <a href="{{ url_for('rotas.exportar_grafico', tipo=tipo, formato='pdf') }}" class="btn btn-sm btn-secondary">游닌 Exportar como PDF</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

    {% elif folhas_por_ficheiro %}
        <hr>
        <!-- Formul치rio para sele칞칚o das folhas desejadas de cada ficheiro -->
        <form action="{{ url_for('rotas.selecionar_folhas') }}" method="post">
            <h3>Selecione as folhas que quer usar:</h3>
            {% for nome, folhas in folhas_por_ficheiro.items() %}
                <strong>{{ nome }}</strong><br>
                {% for folha in folhas %}
                    <input type="checkbox" name="selecionadas_{{ nome }}" value="{{ folha }}" checked>
                    {{ folha }}<br>  <!-- Mostra as folhas de cada ficheiro com checkbox marcado -->
                {% endfor %}
                <br>
            {% endfor %}

            <!-- Campos ocultos com os nomes dos ficheiros, para manter a refer칡ncia no POST -->
            {% for nome in folhas_por_ficheiro %}
                <input type="hidden" name="ficheiros_nome" value="{{ nome }}">
            {% endfor %}

            <button type="submit" class="btn btn-primary">Confirmar folhas</button>
        </form>

    {% else %}
        <!-- Formul치rio para upload de m칰ltiplos ficheiros Excel -->
        <form action="{{ url_for('rotas.upload_excel') }}" method="post" enctype="multipart/form-data">
            <label for="ficheiros">Seleciona ficheiros Excel:</label><br>
            <input type="file" name="ficheiros" multiple required class="form-control"><br><br>  <!-- Permite enviar v치rios ficheiros ao mesmo tempo -->
            <button type="submit" class="btn btn-primary">Carregar ficheiros</button>
        </form>
    {% endif %}
</div>

<!-- Adiciona Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}